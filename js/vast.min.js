var PLAYER=PLAYER||{};PLAYER.Vast=function(i){this.videoPlayer=i,this.options=this.videoPlayer.options,this.vastObj={},this.objVMAP,this.arrVAST=[],this.countVasts=0,this.countXMLS=0,this.maxcountXMLS=0,this.vastADCount=0,this.allVastMediaFilesArr=[],this.allVastNonLinearArr=[],this.allVastCompanionArr=[],this.is_VAST=!1,this.is_VMAP=!1,this.allVastPREROLLS={},this.prerollsCount=0,this.allVastMIDROLLS={},this.midrollsCount=0,this.allVastPOSTROLLS={},this.postrollsCount=0,this.allVastNONLINEARS={},this.nonlinearsCount=0,""!=this.options.vastUrl&&this.loadVastUrl(this.options.vastUrl)},PLAYER.Vast.prototype={},PLAYER.Vast.prototype.loadVastUrl=function(i,t){var r=this;jQuery.ajax({type:"GET",url:i,dataType:"xml",success:function(i){r.linear=jQuery(i).find("Linear").text(),r.nonLinear=jQuery(i).find("NonLinearAds").text();var e=r.xmlToJson(i);r.vast_array=new Array,jQuery(i).find("Ad").each(function(i){var e=jQuery(this).attr("id");jQuery(this).attr("offset");jQuery(this).find("InLine").each(function(){var i=jQuery(this).find("AdSystem").text(),e=jQuery(this).find("AdTitle").text(),t=jQuery(this).find("Description").text(),n=jQuery(this).find("Error").text(),a=jQuery(this).find("Impression").text();jQuery(this).find("Creatives").text();r.creative={},jQuery(this).find("Creatives").each(function(){jQuery(this).find("Creative").each(function(i){var e=jQuery(this).attr("id"),t=jQuery(this).attr("sequence");jQuery(this).find("Linear").each(function(){r.duration={},r.trackingEvents={},r.videoClicks={},r.mediaFiles={},jQuery(this).find("Duration").each(function(){r.duration=jQuery(this).text()}),r.trackingEvents={},jQuery(this).find("TrackingEvents").each(function(){r.tracking={},jQuery(this).find("Tracking").each(function(){var i=jQuery(this).attr("event"),e=jQuery(this).text();r.tracking[i]={event:i,tracking:e}}),r.trackingEvents={tracking:r.tracking}}),r.videoClicks={},jQuery(this).find("VideoClicks").each(function(){jQuery(this).find("ClickThrough").each(function(){r.clickThrough=jQuery(this).text()}),r.videoClicks={clickThrough:r.clickThrough}}),r.mediaFiles={},jQuery(this).find("MediaFiles").each(function(){jQuery(this).find("MediaFile").each(function(){r.mediaFile=jQuery(this).text()}),r.mediaFiles={mediaFiles:r.mediaFile}}),r.linear={duration:r.duration,trackingEvents:r.trackingEvents,videoClicks:r.videoClicks,mediaFiles:r.mediaFiles}}),jQuery(this).find("NonLinearAds").each(function(){r.trackingEvents={},r.nonLinear={},jQuery(this).find("TrackingEvents").each(function(){r.tracking={},jQuery(this).find("Tracking").each(function(){var i=jQuery(this).attr("event"),e=jQuery(this).text();r.tracking[i]={event:i,tracking:e}}),r.trackingEvents={tracking:r.tracking}}),jQuery(this).find("NonLinear").each(function(){r.staticResource={},jQuery(this).find("StaticResource").each(function(){var i=jQuery(this).attr("creativeType"),e=jQuery(this).text();r.staticResource={creativeType:i,staticResource:e}}),jQuery(this).find("NonLinearClickThrough").each(function(){r.nonLinearClickThrough=jQuery(this).text()}),jQuery(this).find("NonLinearClickTracking").each(function(){r.nonLinearClickTracking=jQuery(this).text()}),r.nonLinear={staticResource:r.staticResource,nonLinearClickThrough:r.nonLinearClickThrough,nonLinearClickTracking:r.nonLinearClickTracking}}),r.nonLinearAds={trackingEvents:r.trackingEvents,nonLinear:r.nonLinear}}),0<jQuery(this).find("Linear").length&&(r.creative[i]={id:e,sequence:t,linear:r.linear}),0<jQuery(this).find("NonLinearAds").length&&(r.creative[i]={id:e,sequence:t,nonLinearAds:r.nonLinearAds})}),r.Creatives={Creative:r.creative}}),r.InLine={AdSystem:i,AdTitle:e,Description:t,Error:n,Impression:a,Creatives:r.Creatives}}),r.ad={id:e,InLine:r.InLine},r.vast_array.push(r.ad)}),r.handleLoadedXML(e,t)}})},PLAYER.Vast.prototype.xmlToJson=function(i){var e={};if(1==i.nodeType){if(0<i.attributes.length){e["@attributes"]={};for(var t=0;t<i.attributes.length;t++){var n=i.attributes.item(t);e["@attributes"][n.nodeName]=n.nodeValue}}}else 3==i.nodeType?e=i.nodeValue.trim():4==i.nodeType&&(e=i.nodeValue);if(i.hasChildNodes())for(var a=0;a<i.childNodes.length;a++){var r,s=i.childNodes.item(a),o=s.nodeName;void 0===e[o]?e[o]=this.xmlToJson(s):(void 0===e[o].length&&(r=e[o],e[o]=[],e[o].push(r)),"object"==typeof e[o]&&e[o].push(this.xmlToJson(s)))}return e},PLAYER.Vast.prototype.convertTimeStringToSeconds=function(i){if(!i||!i.match(/^(\d){2}(:[0-5][0-9]){2}(.(\d){1,3})?$/))return!1;i=i.split(":");return 3600*parseInt(i[0],10)+60*parseInt(i[1],10)+parseInt(i[2],10)},PLAYER.Vast.prototype.handleLoadedXML=function(i,e){if(this.countXMLS++,void 0!==i["vmap:VMAP"]){this.is_VMAP=!0,(this.objVMAP=i)["vmap:VMAP"]["vmap:AdBreak"].length||(i["vmap:VMAP"]["vmap:AdBreak"]=[i["vmap:VMAP"]["vmap:AdBreak"]]),this.maxcountXMLS=1;for(var t=0;t<i["vmap:VMAP"]["vmap:AdBreak"].length;t++){this.countVasts++,this.maxcountXMLS++;var n=i["vmap:VMAP"]["vmap:AdBreak"][t]["@attributes"].timeOffset;this.loadVastUrl(i["vmap:VMAP"]["vmap:AdBreak"][t]["vmap:AdSource"]["vmap:AdTagURI"]["#cdata-section"],n)}}if(void 0!==i.VAST){if(0==this.countVasts?(this.vastObj[0]=i,this.maxcountXMLS=1,this.is_VAST=!0):0<this.countVasts&&this.arrVAST.push(i),null==i.VAST.Ad)return void alert("No <Ad> tag found in VAST url. Try refreshing the page.");i.VAST.Ad.length||(i.VAST.Ad=[i.VAST.Ad]);for(t=0;t<i.VAST.Ad.length;t++){e&&this.is_VMAP&&(i.VAST.Ad[t]["@attributes"].timeOffset=e),void 0!==i.VAST.Ad[t]["@attributes"].timeOffset&&(e=i.VAST.Ad[t]["@attributes"].timeOffset),i.VAST.Ad[t].InLine.Creatives.Creative.length||(i.VAST.Ad[t].InLine.Creatives.Creative=[i.VAST.Ad[t].InLine.Creatives.Creative]);for(var a=0;a<i.VAST.Ad[t].InLine.Creatives.Creative.length;a++){if(i.VAST.Ad[t].InLine.Creatives.Creative[a].Linear&&(i.VAST.Ad[t].InLine.Creatives.Creative[a].Linear.MediaFiles.MediaFile.length||(i.VAST.Ad[t].InLine.Creatives.Creative[a].Linear.MediaFiles.MediaFile=[i.VAST.Ad[t].InLine.Creatives.Creative[a].Linear.MediaFiles.MediaFile]),this.allVastMediaFilesArr.push(i.VAST.Ad[t].InLine.Creatives.Creative[a].Linear.MediaFiles.MediaFile[0]["#cdata-section"]),this.clickThrough=i.VAST.Ad[t].InLine.Creatives.Creative[a].Linear.VideoClicks.ClickThrough["#cdata-section"],this.mediaFile=i.VAST.Ad[t].InLine.Creatives.Creative[a].Linear.MediaFiles.MediaFile[0]["#cdata-section"],i.VAST.Ad[t].InLine.Creatives.Creative[a].Linear.hasOwnProperty("@attributes")&&(this.skipoffset=i.VAST.Ad[t].InLine.Creatives.Creative[a].Linear["@attributes"].skipoffset),this.is_VMAP||void 0!==i.VAST.Ad[t]["@attributes"].timeOffset?this.handleROLLS(e,"linear"):(this.allVastPREROLLS[this.prerollsCount]={mediaFile:this.mediaFile,clickThrough:this.clickThrough,skipoffset:this.skipoffset},this.prerollsCount++)),i.VAST.Ad[t].InLine.Creatives.Creative[a].NonLinearAds){i.VAST.Ad[t].InLine.Creatives.Creative[a].NonLinearAds.NonLinear.length||(i.VAST.Ad[t].InLine.Creatives.Creative[a].NonLinearAds.NonLinear=[i.VAST.Ad[t].InLine.Creatives.Creative[a].NonLinearAds.NonLinear]);for(var r=0;r<i.VAST.Ad[t].InLine.Creatives.Creative[a].NonLinearAds.NonLinear.length;r++){i.VAST.Ad[t].InLine.Creatives.Creative[a].NonLinearAds.NonLinear[r].StaticResource.length||(i.VAST.Ad[t].InLine.Creatives.Creative[a].NonLinearAds.NonLinear[r].StaticResource=[i.VAST.Ad[t].InLine.Creatives.Creative[a].NonLinearAds.NonLinear[r].StaticResource]),this.minSuggestedDuration=i.VAST.Ad[t].InLine.Creatives.Creative[a].NonLinearAds.NonLinear[r]["@attributes"].minSuggestedDuration;for(var s=0;s<i.VAST.Ad[t].InLine.Creatives.Creative[a].NonLinearAds.NonLinear[r].StaticResource.length;s++)this.allVastNonLinearArr.push(i.VAST.Ad[t].InLine.Creatives.Creative[a].NonLinearAds.NonLinear[r].StaticResource[s]["#cdata-section"]);this.nonLinearClickThrough=i.VAST.Ad[t].InLine.Creatives.Creative[a].NonLinearAds.NonLinear[r].NonLinearClickThrough["#cdata-section"],this.nonLinearClickTracking=i.VAST.Ad[t].InLine.Creatives.Creative[a].NonLinearAds.NonLinear[r].NonLinearClickTracking["#cdata-section"],this.staticResource=i.VAST.Ad[t].InLine.Creatives.Creative[a].NonLinearAds.NonLinear[r].StaticResource[0]["#cdata-section"],this.handleROLLS(e,"nonlinear")}}i.VAST.Ad[t].InLine.Creatives.Creative[a].CompanionAds&&(i.VAST.Ad[t].InLine.Creatives.Creative[a].CompanionAds.Companion.length||(i.VAST.Ad[t].InLine.Creatives.Creative[a].CompanionAds.Companion=[i.VAST.Ad[t].InLine.Creatives.Creative[a].CompanionAds.Companion]),this.allVastCompanionArr.push(i.VAST.Ad[t].InLine.Creatives.Creative[a].CompanionAds.Companion[0].StaticResource["#cdata-section"]))}}}this.countXMLS==this.maxcountXMLS&&this.initData()},PLAYER.Vast.prototype.handleROLLS=function(i,e){"start"==i&&(this.allVastPREROLLS[this.prerollsCount]={mediaFile:this.mediaFile,clickThrough:this.clickThrough,skipoffset:this.skipoffset},this.prerollsCount++),"end"==i&&(this.allVastPOSTROLLS[this.postrollsCount]={mediaFile:this.mediaFile,clickThrough:this.clickThrough,skipoffset:this.skipoffset},this.postrollsCount++),"start"!==i&&"end"!==i&&("linear"===e&&(this.allVastMIDROLLS[this.midrollsCount]={mediaFile:this.mediaFile,clickThrough:this.clickThrough,skipoffset:this.skipoffset,timeOffset:i},this.midrollsCount++),"nonlinear"===e&&(this.allVastNONLINEARS[this.nonlinearsCount]={staticResource:this.staticResource,nonLinearClickThrough:this.nonLinearClickThrough,nonLinearClickTracking:this.nonLinearClickTracking,minSuggestedDuration:this.minSuggestedDuration,timeOffset:i},this.nonlinearsCount++))},PLAYER.Vast.prototype.initData=function(i){if(0<this.arrVAST.length)for(var e=0;e<this.arrVAST.length;e++)this.vastObj[e]=this.arrVAST[e];this.videoPlayer.checkForPoints()};